---
phase: 02-fix-ts-errors
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/shared-types/src/index.ts
autonomous: true

must_haves:
  truths:
    - No duplicate CartRuleType or CartRuleStatus declarations
    - CartRuleType type alias properly maps to config interfaces
    - Product.quantityInStock and Product.vintage are consistently typed
  artifacts:
    - path: "packages/shared-types/src/index.ts"
      provides: "Clean type definitions without duplicates"
      contains: "export type CartRuleType = 'buy_x_get_y' | 'bulk_discount' | 'shipping'"
  key_links:
    - from: "CartRuleType"
      to: "CartRuleConfig"
      via: "discriminated union pattern"
---

<objective>
Fix TypeScript errors in shared-types package by removing duplicate declarations and fixing type inconsistencies.

Purpose: Shared types are the foundation used by both frontend and backend. Duplicate declarations and inconsistent types propagate errors throughout the codebase.
Output: Clean type definitions that properly support discriminated unions for CartRule configs.
</objective>

<execution_context>
@/Users/danielshmuel.mirshukri/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/danielshmuel.mirshukri/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Current issues:
1. Lines 86-96: CartRuleType and CartRuleStatus declared as enums (old values)
2. Lines 326-327: Same names declared as type aliases (correct values)
3. Line 123: quantityInStock is number | bigint
4. Line 136: vintage is number | bigint

The enum declarations conflict with the type alias declarations. The enum values (SHIPPING, DISCOUNT, RESTRICTION, BENEFIT) don't match the type alias values ('buy_x_get_y', 'bulk_discount', 'shipping').

The bigint type is causing issues in components that expect number.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove duplicate enum declarations</name>
  <files>packages/shared-types/src/index.ts</files>
  <action>
    Remove the enum declarations for CartRuleType and CartRuleStatus (lines 86-96). Keep only the type alias declarations at lines 326-327.

    The type alias values are correct:
    - CartRuleType = 'buy_x_get_y' | 'bulk_discount' | 'shipping'
    - CartRuleStatus = 'draft' | 'active' | 'paused'

    Remove lines 86-96 entirely:
    ```typescript
    export enum CartRuleType {
      SHIPPING = 'shipping',
      DISCOUNT = 'discount',
      RESTRICTION = 'restriction',
      BENEFIT = 'benefit',
    }

    export enum CartRuleStatus {
      ACTIVE = 'active',
      PAUSED = 'paused',
    }
    ```
  </action>
  <verify>grep -n "export enum CartRuleType\|export enum CartRuleStatus" packages/shared-types/src/index.ts</verify>
  <done>No enum declarations for CartRuleType or CartRuleStatus exist; only type aliases remain</done>
</task>

<task type="auto">
  <name>Task 2: Change Product bigint types to number</name>
  <files>packages/shared-types/src/index.ts</files>
  <action>
    Change the Product interface to use number instead of number | bigint for:
    - Line 123: quantityInStock
    - Line 136: vintage

    These should be:
    ```typescript
    quantityInStock: number;
    vintage?: number;
    ```

    This resolves type mismatches in ProductCard.tsx and ProductTableRow.tsx where these values are used as React children or passed to functions expecting number.
  </action>
  <verify>grep -A2 "quantityInStock:\|vintage:" packages/shared-types/src/index.ts | head -10</verify>
  <done>quantityInStock and vintage are typed as number only (not number | bigint)</done>
</task>

<task type="auto">
  <name>Task 3: Remove duplicate CartRule interface</name>
  <files>packages/shared-types/src/index.ts</files>
  <action>
    The file has TWO CartRule interface declarations (lines 351-363 and 365-377). Remove the second duplicate (lines 365-377).

    Keep only the first one at lines 351-363.
  </action>
  <verify>grep -n "export interface CartRule" packages/shared-types/src/index.ts</verify>
  <done>Only one CartRule interface declaration exists</done>
</task>

</tasks>

<verification>
1. Run `npx tsc --noEmit -p packages/shared-types` to verify the types compile
2. Check that no duplicate declarations remain
3. Verify CartRuleType, CartRuleStatus, CartRuleConfig form a proper discriminated union
</verification>

<success_criteria>
- No TS2567 errors (enum declarations can only merge...)
- CartRuleType and CartRuleStatus are type aliases only
- Product.quantityInStock and Product.vintage are number types
- Only one CartRule interface exists
</success_criteria>

<output>
After completion, create `.planning/phases/02-fix-ts-errors/02-01-SUMMARY.md`
</output>
