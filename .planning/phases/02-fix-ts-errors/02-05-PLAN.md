---
phase: 02-fix-ts-errors
plan: 05
type: execute
wave: 5
depends_on: ["02-01", "02-02", "02-03", "02-04"]
files_modified:
  - apps/admin/pages/CartRuleEditor.tsx
  - apps/admin/components/cart-rules/CartRuleBasicInfoCard.tsx
  - apps/admin/components/cart-rules/CartRuleConfigCard.tsx
autonomous: true

must_haves:
  truths:
    - CartRuleEditor form types align with child component props
    - CartRuleBasicInfoCard accepts proper register and control types
    - CartRuleConfigCard accepts proper register type
  artifacts:
    - path: "apps/admin/pages/CartRuleEditor.tsx"
      provides: "Cart rule editor with aligned form types"
    - path: "apps/admin/components/cart-rules/CartRuleBasicInfoCard.tsx"
      provides: "Basic info card with flexible form types"
    - path: "apps/admin/components/cart-rules/CartRuleConfigCard.tsx"
      provides: "Config card with flexible form types"
  key_links:
    - from: "CartRuleEditor"
      to: "CartRuleBasicInfoCard"
      via: "register and control props"
---

<objective>
Fix TypeScript errors in CartRuleEditor and child components related to react-hook-form type mismatches.

Purpose: The CartRuleEditor form and its child cards need consistent typing to work together properly.
Output: CartRuleEditor and child components compile without form type errors.
</objective>

<execution_context>
@/Users/danielshmuel.mirshukri/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/danielshmuel.mirshukri/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Current issues in CartRuleEditor.tsx:
- Line 54: Type 'UseFormRegister<CartRuleForm>' is not assignable to 'UseFormRegister<CartRuleFormData>'
- Line 55: Type 'Control<CartRuleForm, any, TFieldValues>' is not assignable to 'Control<CartRuleFormData>'
- Line 62: Same register type issue with CartRuleConfigCard

The issue is that the child components (CartRuleBasicInfoCard, CartRuleConfigCard) use CartRuleFormData while the parent uses CartRuleForm. These interfaces have slight differences (description optional vs required).

Need to read the child component files to understand their expected types.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Read child component prop types</name>
  <files>apps/admin/components/cart-rules/CartRuleBasicInfoCard.tsx, apps/admin/components/cart-rules/CartRuleConfigCard.tsx</files>
  <action>
    Read both files to understand what types they expect for register and control props.

    Look for:
    - interface CartRuleBasicInfoCardProps
    - interface CartRuleConfigCardProps
    - What type is register declared as?
    - What type is control declared as?
    - Is there a CartRuleFormData interface in these files?

    This will help determine if we should:
    1. Update the child components to use CartRuleForm
    2. Update the parent to use CartRuleFormData
    3. Make the types compatible
  </action>
  <verify>cat apps/admin/components/cart-rules/CartRuleBasicInfoCard.tsx | head -50</verify>
  <done>Understand the prop types expected by child components</done>
</task>

<task type="auto">
  <name>Task 2: Fix CartRuleBasicInfoCard prop types</name>
  <files>apps/admin/components/cart-rules/CartRuleBasicInfoCard.tsx</files>
  <action>
    The component likely defines its own CartRuleFormData interface that's slightly different from CartRuleForm in the hook.

    Options to fix:
    1. Import CartRuleForm from the hook and use that type
    2. Make CartRuleFormData compatible with CartRuleForm
    3. Use more generic types for register/control

    Recommended approach: Use generic types from react-hook-form:
    ```typescript
    import { UseFormRegister, Control, FieldValues } from 'react-hook-form';

    interface CartRuleBasicInfoCardProps {
      register: UseFormRegister<FieldValues>;
      control: Control<FieldValues>;
      errors: FieldErrors<FieldValues>;
      // ... other props
    }
    ```

    Or if the component needs specific field names, keep the interface but ensure compatibility:
    ```typescript
    interface CartRuleBasicInfoCardProps {
      register: UseFormRegister<CartRuleForm>;
      control: Control<CartRuleForm>;
      // ...
    }
    ```

    Update the component to import CartRuleForm from the hook or shared types.
  </action>
  <verify>npx tsc --noEmit apps/admin/components/cart-rules/CartRuleBasicInfoCard.tsx 2>&1 | grep "TS2322\|register\|control" | head -10</verify>
  <done>No type errors on register or control props</done>
</task>

<task type="auto">
  <name>Task 3: Fix CartRuleConfigCard prop types</name>
  <files>apps/admin/components/cart-rules/CartRuleConfigCard.tsx</files>
  <action>
    Same issue as CartRuleBasicInfoCard - register prop type mismatch.

    Update to use compatible types with CartRuleForm from the hook.

    If the component uses CartRuleFormData internally, either:
    1. Import and use CartRuleForm instead
    2. Make both interfaces identical by moving CartRuleForm to shared types

    Recommended: Import CartRuleForm from the hook file:
    ```typescript
    import { CartRuleForm } from '../../hooks/useCartRuleEditor';
    ```

    Then use it in the props:
    ```typescript
    interface CartRuleConfigCardProps {
      register: UseFormRegister<CartRuleForm>;
      errors: FieldErrors<CartRuleForm>;
      ruleType?: 'buy_x_get_y' | 'bulk_discount' | 'shipping';
      getValueLabel: (ruleType: string) => string;
    }
    ```
  </action>
  <verify>npx tsc --noEmit apps/admin/components/cart-rules/CartRuleConfigCard.tsx 2>&1 | grep "TS2322\|register" | head -10</verify>
  <done>No type errors on register prop</done>
</task>

<task type="auto">
  <name>Task 4: Verify CartRuleEditor.tsx compiles</name>
  <files>apps/admin/pages/CartRuleEditor.tsx</files>
  <action>
    After fixing the child components, verify that CartRuleEditor.tsx compiles without errors.

    The file should now be able to pass register and control props without type errors.

    If there are still errors, check:
    1. Are the imports correct?
    2. Does CartRuleForm in the hook match what child components expect?
    3. Are there any other type mismatches?
  </action>
  <verify>npx tsc --noEmit apps/admin/pages/CartRuleEditor.tsx 2>&1 | head -20</verify>
  <done>CartRuleEditor.tsx compiles without type errors</done>
</task>

</tasks>

<verification>
1. Run `npx tsc --noEmit` on all three files
2. Verify form types are compatible between parent and children
3. Ensure register and control props work correctly
</verification>

<success_criteria>
- No TS2322 errors (type not assignable to type)
- CartRuleEditor, CartRuleBasicInfoCard, and CartRuleConfigCard all compile
- register and control props have compatible types across components
</success_criteria>

<output>
After completion, create `.planning/phases/02-fix-ts-errors/02-05-SUMMARY.md`
</output>
