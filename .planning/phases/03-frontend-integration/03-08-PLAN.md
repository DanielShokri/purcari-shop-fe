# Plan 03-08: Admin Migration - Final Cleanup & Auth

## Objective
Fully decommission Appwrite from the Admin application by migrating authentication, global search, and cart rules, followed by a complete cleanup of legacy code and dependencies.

## Context
All core data modules (Products, Orders, Users, Categories, Coupons) have been migrated to Convex. Authentication and global utility pages are the last remaining pieces using Appwrite.

## Tasks
- [ ] **Task 1: Migrate Admin Authentication**
  - Refactor `apps/admin/pages/Login.tsx` to use Convex Auth (`signIn`).
  - Implement admin-check logic (role validation) post-login.
  - Refactor `apps/admin/components/Layout.tsx` to use `useAuth` and Convex `signOut`.
- [ ] **Task 2: Migrate Global Search**
  - Implement cross-table search query in `convex/admin.ts` (searching `products`, `orders`, `users`).
  - Refactor `apps/admin/pages/Search.tsx` to use the new Convex query.
- [ ] **Task 3: Migrate Cart Rules**
  - Refactor `apps/admin/pages/CartRules.tsx` to use Convex `cartRules` table.
- [ ] **Task 4: Legacy Cleanup**
  - Refactor `Notifications.tsx` and `Analytics.tsx` to use Convex (or placeholder until implemented).
  - Delete `apps/admin/services/api/` directory.
  - Remove `appwrite` and `@reduxjs/toolkit` from `apps/admin/package.json`.
  - Update `apps/admin/AGENTS.md` to reflect Convex-first architecture.

## Verification Criteria
- Admin can login and logout securely via Convex.
- Global search returns results from all relevant tables.
- No remaining imports from `../services/api` in the codebase.
- Admin build succeeds after removing Appwrite dependency.

## Success Criteria
- Admin app is 100% decoupled from Appwrite.
- Unified authentication flow across Storefront and Admin (using different roles).
- Project structure reflects the new Convex-centric architecture.
