---
phase: 03-frontend-integration
plan: 03
type: execute
wave: 3
depends_on: [03-02]
autonomous: true
---

<objective>
Implement Cart persistence and Auth integration in the Storefront using Convex.
</objective>

<context>
@.planning/STATE.md
@apps/storefront/store/slices/cartSlice.ts
@convex/users.ts
@convex/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend User Schema and Functions for Cart</name>
  <action>
    - Add `cart` field to the `users` table in `convex/schema.ts` (optional, or use preferences).
    - Implement `getCart` and `updateCart` mutations in `convex/users.ts`.
  </action>
  <verify>Check `convex/users.ts` for cart-related mutations.</verify>
  <done>Convex backend supports cart persistence.</done>
</task>

<task type="auto">
  <name>Task 2: Update Cart Redux Slice for Convex</name>
  <action>
    - Replace Appwrite-based cloud sync logic in `cartSlice.ts` with Convex mutations.
    - Update `initializeCart` and `syncCartOnLogin` thunks to use Convex.
    - Remove references to `account.getPrefs()` and `account.updatePrefs()`.
  </action>
  <verify>Verify `cartSlice.ts` no longer imports `@shared/services` for Appwrite account.</verify>
  <done>Redux cart is synced with Convex.</done>
</task>

<task type="auto">
  <name>Task 3: Refactor Authentication Logic</name>
  <action>
    - Update `LoginPage.tsx` and `AuthForm.tsx` to use Convex Auth hooks.
    - Implement a `useAuth` hook or equivalent to manage session state.
    - Ensure logout clears both local and cloud cart (if desired) via Convex.
  </action>
  <verify>User can log in/out using Convex, and cart persists across sessions.</verify>
  <done>Authentication is powered by Convex.</done>
</task>

</tasks>

<verification>
Log in as a user, add items to cart, log out, log in again, and verify items are still in the cart.
</verification>

<success_criteria>
Cart and Auth are fully migrated to Convex in the Storefront.
</success_criteria>

<output>
After completion, create `.planning/phases/03-frontend-integration/03-03-SUMMARY.md`
</output>
