---
phase: 3
plan: 5
type: integration
autonomous: true
wave: 3
depends_on: ["03-04"]
---

# Plan 3-5: Admin Migration - Dashboard & Products

Migrate the Admin Dashboard and Product Management modules from Appwrite to Convex.

## Objective
Enable admin users to view sales analytics on the dashboard and manage the product catalog using Convex.

## Context Files
- @apps/admin/pages/Dashboard.tsx
- @apps/admin/pages/Products.tsx
- @apps/admin/pages/ProductEditor.tsx
- @apps/admin/services/api/dashboardApi.ts
- @apps/admin/services/api/productsApi.ts

## Tasks

### 1. Admin Auth & Layout [type="auto"]
- [ ] Update `apps/admin/App.tsx` to include `ConvexAuthProvider`.
- [ ] Replace `useGetCurrentUserQuery` in `apps/admin/components/layout-parts/Header.tsx` and `Sidebar.tsx`.
- [ ] Implement admin role check (ensure `user.role === 'admin'`).

### 2. Admin Dashboard Migration [type="auto"]
- [ ] Update `apps/admin/pages/Dashboard.tsx`:
    - [ ] Fetch total sales, order count, and customer count from Convex.
    - [ ] Fetch recent orders using `api.orders.listAll`.
    - [ ] Replace `dashboardApi.ts` calls with Convex queries.

### 3. Product List Migration [type="auto"]
- [ ] Update `apps/admin/pages/Products.tsx`:
    - [ ] Replace `useGetProductsQuery` with `useQuery(api.products.list)`.
    - [ ] Implement status filtering using Convex indexes.
    - [ ] Update `ProductTableRow.tsx` to handle Convex data structure.

### 4. Product Editor Migration [type="auto"]
- [ ] Update `apps/admin/pages/ProductEditor.tsx`:
    - [ ] Fetch product details using `useQuery(api.products.get)`.
    - [ ] Implement create/update/delete using Convex mutations (`api.products.create`, `api.products.update`, `api.products.remove`).
    - [ ] Ensure all fields (wine-specific, SEO, status) are mapped correctly.

## Verification Criteria
- [ ] Admin dashboard displays correct stats from Convex.
- [ ] Recent orders list populated with live data.
- [ ] Product list shows all items with correct status badges.
- [ ] Creating, editing, and deleting products reflects immediately in Convex.
- [ ] Access is restricted to users with the 'admin' role.

## Success Criteria
- [ ] Admin users can fully manage the product catalog.
- [ ] Dashboard provides real-time overview of store performance.
- [ ] No Appwrite dependencies remain in the Dashboard or Product modules.
